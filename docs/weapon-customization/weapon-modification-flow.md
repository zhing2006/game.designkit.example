# 武器改造流程说明文档

**功能**: 001-weapon-customization | **版本**: 1.0.0
**创建日期**: 2025-11-14 | **游戏**: 归途（The Way Back）

---

## 文档概述

本文档为玩家和开发团队提供清晰的武器改造操作指南，包括基础改造流程、配置切换流程、涂装应用流程、错误处理和新手引导。确保流程流畅且易于理解。

**目标受众**: 游戏设计师、UI/UX设计师、程序员、QA测试
**参考文档**: gunsmith-system-design.md（系统设计）、spec.md（用户故事）

---

## 1. 流程概览

### 1.1 基础改造流程图

```
开始
  ↓
[1] 进入枪匠工作台（安全区交互点）
  ↓
[2] 选择武器（从"我的武器库"）
  ↓
[3] 浏览组件（点击槽位查看可用组件）
  ↓
[4] 安装/替换/移除组件
  ├─ 兼容性检查（自动）
  ├─ 预览属性变化
  └─ 确认操作
  ↓
[5] 预览效果（属性雷达图、3D模型更新）
  ↓
[6] 保存配置（可选，命名并保存）
  ↓
[7] 确认改造（最终确认，退出工作台）
  ↓
完成
```

**流程时长**: 首次改造约5-8分钟（含学习），熟练后2-3分钟

### 1.2 流程阶段说明

| 阶段 | 时长 | 关键操作 | 可撤销？ |
|------|------|---------|---------|
| 1. 进入工作台 | 5秒 | 找到并交互 | ✅ 可随时退出 |
| 2. 选择武器 | 10-30秒 | 浏览武器库、选择目标武器 | ✅ 可返回上一步 |
| 3. 浏览组件 | 30-60秒 | 查看可用组件、对比属性 | ✅ 可返回上一步 |
| 4. 安装组件 | 20-40秒 | 选择组件、预览、确认 | ✅ 确认前可撤销 |
| 5. 预览效果 | 20-40秒 | 旋转查看、测试属性 | ✅ 可继续调整 |
| 6. 保存配置 | 10-20秒 | 命名、保存配置 | ✅ 可选步骤 |
| 7. 确认改造 | 5秒 | 最终确认 | ❌ 确认后生效 |

---

## 2. 详细步骤

### 步骤1: 进入枪匠工作台

**位置**: 安全区的枪匠工作站（三大阵营各有一个）

**前置条件**:
- 玩家在安全区（非战斗状态）
- 玩家拥有至少一把武器

**交互方式**:
- 走近枪匠工作台
- 显示交互提示："[E] 枪匠工作台"
- 按键交互 → 进入工作台界面

**界面打开**:
- 播放工作台打开动画（约1秒）
- 背景音效：工具声、其他NPC改装武器的环境音
- 显示主界面：3D旋转视图、武器库、操作选项

### 步骤2: 选择武器

**武器库显示**:
```
我的武器库:
┌──────────┐ ┌──────────┐ ┌──────────┐
│  AK-47   │ │  M4A1    │ │  MP5     │
│  [已改装] │ │  [默认]  │ │  [已改装] │
│  CQB配置 │ │          │ │  远程配置 │
└──────────┘ └──────────┘ └──────────┘
```

**操作**:
- 点击武器图标 → 选择该武器
- 显示武器当前配置（如"CQB配置"或"默认配置"）
- 3D视图切换到选中武器

**筛选和排序**:
- 按武器类型筛选（步枪、手枪、霰弹枪等）
- 按改装状态排序（已改装/未改装）
- 搜索武器名称

### 步骤3: 浏览组件

**槽位选择**:
```
当前武器: AK-47
当前配置: 默认配置

槽位选择:
┌─────┐ ┌─────┐ ┌─────┐
│枪口 │ │瞄具 │ │弹匣 │
│ [空]│ │机械 │ │标准 │
└─────┘ └─────┘ └─────┘
┌─────┐ ┌─────┐ ┌─────┐
│握把 │ │附件 │ │枪托 │
│ [空]│ │ [空]│ │固定 │
└─────┘ └─────┘ └─────┘
```

**点击槽位** → 显示组件列表界面:
```
握把槽位 - 可用组件:
┌────────────────────────────────┐
│ [蓝色] 战术前握把            ✨ NEW│
│ +12%后坐力控制 -5%机动性        │
│ [查看详情] [安装]               │
├────────────────────────────────┤
│ [绿色] 普通握把                 │
│ +8%后坐力控制 -8%机动性         │
│ [查看详情] [安装]               │
└────────────────────────────────┘

筛选: [按品质] [按属性] [收藏的]
```

**组件列表显示**:
- 品质标识（颜色边框）
- 组件名称
- 核心属性（正向绿色、负向红色）
- "新获得"标记
- 操作按钮（查看详情、安装）

**查看详情**:
- 点击"查看详情" → 显示完整属性、3D模型、组件描述
- 可360度旋转查看组件模型

### 步骤4: 安装/替换/移除组件

#### 4.1 安装新组件

**操作流程**:
1. 选择组件 → 点击"安装"
2. **兼容性自动检查**:
   - 如果兼容 → 进入预览界面
   - 如果不兼容 → 显示错误提示
3. 预览效果 → 确认安装

**兼容性检查**:
- 自动执行，玩家无需手动检查
- 不兼容组件在列表中灰显
- 悬停显示原因："该瞄具需要战术导轨"

**安装效果**:
- 播放组件安装动画（瞄具卡入导轨、握把螺丝拧紧）
- 播放安装音效（金属卡扣声）
- 武器3D模型实时更新（可见新组件）

#### 4.2 替换已有组件

**操作流程**:
1. 点击已安装的组件槽位
2. 选择"替换"→ 显示可用组件列表
3. 选择新组件 → 显示新旧对比界面

**新旧对比界面**:
```
替换握把:
┌───────────────┬───────────────┐
│  当前组件      │  新组件        │
├───────────────┼───────────────┤
│ 普通前握把     │ 战术前握把     │
│ [绿色]        │ [蓝色]        │
│ -8%后坐力     │ -12%后坐力    │
│ -8%机动性     │ -3%机动性     │
├───────────────┼───────────────┤
│         变化预览:              │
│  后坐力控制: 6/10 → 7/10 ⬆️   │
│  机动性: 5/10 → 6/10 ⬆️       │
└───────────────────────────────┘
         [确认替换] [取消]
```

**替换效果**:
- 旧组件返回库存（不消失）
- 新组件从库存扣除
- 武器属性和外观更新

#### 4.3 移除组件

**操作流程**:
1. 点击已安装的组件
2. 选择"移除"
3. 确认移除

**移除效果**:
- 组件返回库存
- 武器恢复该槽位的默认状态（如瞄具恢复为机械瞄具）
- 属性变化被移除（如瞄准速度从7/10降回6/10）

**无惩罚成本**: 移除组件不消耗任何资源，鼓励玩家实验不同配置

### 步骤5: 预览效果

**属性雷达图**:
```
        后坐力控制
            ↑
            8
           /|\
          / | \
机动性 6 ←──●──→ 6 精准度
          \ | /
           \|/
            7
            ↓
          射程
```

**对比模式**:
- 半透明显示改造前属性（灰色）
- 实线显示改造后属性（彩色）
- 箭头标识变化方向（⬆️ 提升，⬇️ 降低）

**3D模型更新**:
- 实时显示安装的组件（如红点瞄具、战术握把）
- 可360度旋转查看细节
- 组件安装位置准确（枪口装置在枪管末端、握把在前护木位置）

### 步骤6: 保存配置（可选）

**何时保存**:
- 玩家满意当前配置时
- 为不同战斗场景创建多个配置时

**保存流程**:
1. 点击"保存配置"按钮
2. 输入配置名称（最多20个字符）
3. 可选输入描述（如"室内建筑专用"）
4. 确认保存

**配置槽位**:
- 至少5个配置槽位
- 显示已保存的配置列表
- 可编辑、删除、锁定配置

### 步骤7: 确认改造

**最终确认**:
- 点击"确认改造"按钮
- 显示改造摘要（安装了哪些组件、属性变化）
- 最后一次确认提示："确认应用改造？"

**改造生效**:
- 武器配置永久保存
- 下次进入危险区域时，携带改造后的武器
- 可随时返回工作台继续调整

**退出工作台**:
- 播放关闭动画
- 返回安全区

---

## 3. 特殊流程

### 3.1 配置快速切换流程

**使用场景**: 玩家已有多个保存的配置，想要针对不同地图快速切换

**详细步骤**:

```
1. 进入工作台 → 选择武器 → 点击"配置管理"
   ↓
2. 显示已保存的配置列表
   ┌──────────────────────────┐
   │ [图标] CQB配置 (当前)     │
   │ 高机动性、近距离作战      │
   │ [查看详情] [切换] [编辑]  │
   ├──────────────────────────┤
   │ [图标] 远程配置           │
   │ 高精准、远距离狙击        │
   │ 需要: ✅全部拥有          │
   │ [查看详情] [切换] [编辑]  │
   └──────────────────────────┘
   ↓
3. 点击"切换"按钮
   ↓
4. 系统检查库存
   ├─ 拥有所有组件 → 确认切换
   │    ↓
   │  自动卸下当前配置的所有组件（返回库存）
   │    ↓
   │  自动安装目标配置的所有组件（从库存扣除）
   │    ↓
   │  播放切换动画（<3秒）
   │    ↓
   │  切换完成
   │
   └─ 缺少组件 → 显示缺失列表
        ↓
      ┌──────────────────────────┐
      │ 缺少组件:                 │
      │ ❌ 精准弹匣 x1           │
      │                          │
      │ 选择操作:                 │
      │ [使用其他弹匣替代]        │
      │ [取消切换]               │
      └──────────────────────────┘
        ↓
      玩家选择替代或取消
```

**切换时间**: 整个切换过程<3秒（包含动画），保持流畅

**切换动画**:
- 显示组件自动卸载/安装的流程动画
- 播放金属卡扣声、螺丝拧紧声
- 3D模型实时更新

### 3.2 缺失组件处理流程

**场景**: 玩家想切换到"远程配置"，但精准弹匣被用在另一把武器上

**处理流程**:

```
检测到缺失组件
  ↓
显示缺失列表:
┌────────────────────────────────┐
│ 缺少组件: ❌ 精准弹匣 x1       │
│                                │
│ 原因: 该组件已安装在 M4步枪    │
│                                │
│ 替代方案:                       │
│ ✅ 扩容弹匣（绿色）- 库存中     │
│ ✅ 快速弹匣（蓝色）- 库存中     │
│                                │
│ 选择操作:                       │
│ [使用扩容弹匣替代]              │
│ [使用快速弹匣替代]              │
│ [从M4上卸下精准弹匣]            │
│ [取消切换]                     │
└────────────────────────────────┘
```

**替代方案提供**:
- 显示库存中同槽位的其他组件
- 显示组件品质和核心属性
- 玩家可选择替代品或取消

**从其他武器卸下**:
- 如选择"从M4上卸下精准弹匣"
- 自动卸下M4上的该组件
- 安装到当前武器
- 提示："精准弹匣已从M4移除"

### 3.3 系统推荐配置应用流程

**使用场景**: 新手玩家不知道如何配置，想要使用系统推荐

**详细步骤**:

```
1. 点击"系统推荐配置"标签
   ↓
2. 显示推荐配置列表
   ┌──────────────────────────────┐
   │ [图标] 新手友好配置           │
   │ 理念: 低后坐力、易控制        │
   │ 适用: 新手玩家、近中距离      │
   │                              │
   │ 需要组件:                     │
   │ ✅ 战术握把（绿色）- 拥有     │
   │ ✅ 红点瞄具（绿色）- 拥有     │
   │ ✅ 补偿器（绿色）- 拥有       │
   │ ✅ 扩容弹匣（绿色）- 拥有     │
   │                              │
   │ [应用配置]                   │
   └──────────────────────────────┘
   ↓
3. 点击"应用配置"
   ↓
4. 系统检查库存
   ├─ 全部拥有 → 自动安装所有组件 → 完成
   └─ 缺少组件 → 显示缺失组件提示
                  ↓
                "需要搜刮: 战术前握把 x1"
                [取消] [使用其他组件替代]
```

**推荐依据**:
- 新手友好配置: 全绿色组件，无复杂操作，易获得
- 远程精准配置: 蓝色/紫色组件，高精准和射程
- 近战突击配置: 高机动性组件，快速切换

---

## 4. 涂装应用流程

### 4.1 涂装浏览和预览

**进入涂装界面**:
1. 在工作台选择武器
2. 点击"涂装"选项卡
3. 显示涂装库

**涂装库界面**:
```
涂装库 - 可用涂装:
┌──────────────────────────────────────┐
│ [缩略图]              [缩略图]        │
│ 荒野烈焰 [紫色]       都市迷彩 [蓝色] │
│ [预览] [应用]         [预览] [应用]   │
├──────────────────────────────────────┤
│ [缩略图]              [缩略图]        │
│ 单色黑 [白色]         基础迷彩 [绿色] │
│ [预览] [应用]         [预览] [应用]   │
└──────────────────────────────────────┘

筛选: [按品质] [按阵营] [收藏的]
```

**3D预览**:
- 点击"预览" → 武器3D视图应用该涂装
- 可360度旋转查看涂装效果
- 显示涂装描述（如"荒野猎人阵营的标志性涂装，红黄渐变色"）

### 4.2 涂装应用

**应用流程**:
```
选择涂装 → 点击"应用"
  ↓
立即生效（无消耗、无冷却）
  ↓
武器外观更新
  ↓
涂装应用完成
```

**应用效果**:
- 涂装从库存"应用中"状态（仍在库存，但标记为"使用中"）
- 武器在游戏中显示该涂装
- 第一人称视角可清晰看到涂装细节

### 4.3 涂装更换

**更换流程**:
```
在涂装界面选择"移除涂装"或选择其他涂装
  ↓
当前涂装立即返回库存（移除"使用中"标记）
  ↓
新涂装应用（如选择了其他涂装）
  ↓
武器外观更新
```

**无成本更换**:
- 涂装可重复使用
- 移除不消耗任何资源
- 无冷却时间，随时更换

---

## 5. 错误处理

### 5.1 兼容性冲突

**错误场景**: 玩家尝试安装需要依赖的高级组件

**错误提示**:
```
┌─────────────────────────────────────┐
│ ⚠️ 兼容性问题                        │
│                                     │
│ 该瞄具需要战术导轨支持              │
│ 当前枪托不提供导轨                  │
│                                     │
│ 建议解决方案:                        │
│ 1. 先安装战术枪托（蓝色）- 库存中   │
│ 2. 使用其他瞄具（不需要导轨）       │
│                                     │
│ [应用战术枪托] [选择其他] [取消]    │
└─────────────────────────────────────┘
```

**解决方案提供**:
- 自动检测缺少的依赖组件
- 如库存中有依赖组件 → 提供"一键安装"
- 如无依赖组件 → 提供"选择其他组件"选项

### 5.2 库存不足

**错误场景**: 玩家想要安装组件，但该组件不在库存中

**错误提示**:
```
┌─────────────────────────────────────┐
│ 📦 库存不足                          │
│                                     │
│ 战术前握把不在库存中                │
│                                     │
│ 获取途径提示:                        │
│ • 在中高难度区域搜刮军事据点        │
│ • 完成秩序同盟枪匠委托任务          │
│ • 向商人交易（需要货币500）         │
│                                     │
│ [查看替代组件] [关闭]               │
└─────────────────────────────────────┘
```

**引导玩家**:
- 显示组件的主要获取途径
- 提供库存中的替代组件选项

### 5.3 误操作撤销

**撤销功能**:
- 在确认前，提供"撤销上一步操作"按钮
- 可连续撤销多步操作（最多撤销5步）
- 撤销后恢复到上一步的状态

**撤销范围**:
- 仅在改造过程中有效（确认前）
- 确认改造后不可撤销（但可以重新进入工作台调整）

---

## 6. 新手引导

### 6.1 首次使用提示

**首次进入工作台**:
```
┌────────────────────────────────────┐
│ 欢迎使用枪匠工作台！                │
│                                    │
│ 💡 提示:                            │
│ 1. 点击槽位选择组件                │
│ 2. 查看属性雷达图了解变化          │
│ 3. 使用"系统推荐配置"快速上手      │
│                                    │
│ [开始改造] [查看完整教程] [跳过]   │
└────────────────────────────────────┘
```

**教程内容**（可选查看）:
- 步骤1: 选择武器和槽位
- 步骤2: 浏览组件和安装
- 步骤3: 预览效果和确认
- 步骤4: 保存配置（可选）

### 6.2 关键操作高亮

**首次操作时**:
- 槽位按钮高亮闪烁（引导点击）
- "预览"按钮高亮（引导查看属性变化）
- "系统推荐配置"高亮（引导新手使用预设）

**提示气泡**:
- 悬停在槽位时显示："点击查看可用组件"
- 悬停在属性雷达图时显示："绿色=增益，红色=减益"

### 6.3 系统推荐引导

**新手检测**:
- 如果玩家进入工作台次数<3次 → 优先显示"新手友好配置"
- 如果玩家从未保存过配置 → 提示"试试保存配置，下次快速切换"

**推荐时机**:
- 选择武器后 → 自动弹出："推荐使用'新手友好配置'，降低后坐力更易控制"
- 玩家可选择"应用"或"自己配置"

---

## 7. 流程时间预估

### 7.1 新手玩家

**首次改造**:
- 进入工作台: 5秒
- 观看教程: 60-90秒（可跳过）
- 选择武器: 20-30秒
- 浏览和理解组件: 120-180秒
- 安装和预览: 60-90秒
- 确认改造: 10秒
- **总计**: 约5-8分钟

**熟练后（第3次以后）**:
- 进入和选择武器: 15秒
- 浏览和安装组件: 60-90秒
- 预览和确认: 30秒
- **总计**: 约2-3分钟

### 7.2 老手玩家

**配置切换**:
- 进入工作台: 5秒
- 选择配置管理: 5秒
- 选择目标配置: 5秒
- 自动切换: <3秒
- **总计**: 约20秒（非常快速）

**新组件实验**:
- 浏览新获得的组件: 30秒
- 安装和测试: 60秒
- 调整和保存: 30秒
- **总计**: 约2分钟

---

## 8. 操作输入映射（参考）

**键盘鼠标**:
- 左键点击: 选择、确认
- 右键点击: 取消、返回
- 鼠标拖拽: 旋转3D视图
- 滚轮: 缩放3D视图
- ESC: 退出工作台

**手柄（主机）**:
- A/X: 选择、确认
- B/O: 取消、返回
- 右摇杆: 旋转3D视图
- L1/R1: 切换槽位
- Start: 退出工作台

---

## 9. 流程验收标准

### 9.1 基础改造流程验收

基于 spec.md 用户故事1的4个验收场景：

**场景1**: 安装组件和预览
- 玩家选择AK步枪，安装白色前握把和绿色红点瞄具
- 界面显示属性变化（后坐力控制 5/10 → 6/10，瞄准速度 6/10 → 7/10）
- 武器外观更新（可见前握把和红点瞄具模型）

**场景2**: 实际效果测试
- 改造完成后进入低难度区域
- 使用改造后的步枪射击10发子弹
- 后坐力明显低于改造前（准星跳动减少约10%）

**场景3**: 替换组件
- 选择已安装的前握把，选择"替换"
- 选择蓝色前握把（-15%后坐力，+10%重量）
- 显示新旧对比，确认后旧组件返回库存

**场景4**: 移除组件
- 选择已安装的红点瞄具，选择"移除"
- 瞄具返回库存，武器恢复机械瞄具
- 属性变化被移除（瞄准速度从7/10降回6/10）

### 9.2 配置切换流程验收

基于 spec.md 用户故事3的验收场景：

**场景1**: 成功切换
- 玩家当前"CQB配置"，切换到"远程配置"
- 系统自动卸下CQB的所有组件（返回库存）
- 系统自动安装远程配置的所有组件（从库存扣除）
- 整个过程<3秒，流畅

**场景2**: 缺失组件处理
- 切换时发现缺少"精准弹匣"
- 系统显示缺失列表，标红缺失组件
- 提供替代方案或取消选项

### 9.3 涂装应用流程验收

基于 spec.md 用户故事4的验收场景：

**场景1**: 涂装预览和应用
- 玩家浏览3个涂装（白色/蓝色/紫色）
- 选择"荒野烈焰"（紫色）
- 360度旋转预览涂装效果（红黄渐变、金属光泽）
- 应用涂装，武器外观更新

**场景2**: 游戏内可见性
- 进入危险区域后持枪
- 第一人称视角可清晰看到涂装细节（枪身、弹匣、枪托）
- 涂装在不同光照下有正确反射和阴影

---

**文档版本**: 1.0.0 | **创建日期**: 2025-11-14
**最后更新**: 2025-11-14 | **状态**: 初稿完成
